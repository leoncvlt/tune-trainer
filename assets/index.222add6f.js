import{v as t,s as e,l as n,p as r,y as a,j as l,S as o}from"./vendor.97735c7e.js";const c=t=>{const e=t.split(":");let n=parseFloat(e[e.length-1]);return e.length>1&&(n+=parseFloat(60*e[e.length-2])),e.length>2&&(n+=parseFloat(60*e[e.length-2]*60)),n},s=t=>{const e=parseInt(t,10);let n=Math.floor(e/3600),r=Math.floor((e-3600*n)/60),a=parseFloat(t)-3600*n-60*r;0===n&&(n=""),r<10&&0!==n&&(r="0"+r),a<10&&(a="0"+a);return n+(n?":":"")+r+":"+a},u=({data:e,index:n,active:r,dispatch:a})=>{const l=e.split("@"),o=l[0];let[u,p]=l[1].split("-");u=c(u),p=c(p);const i={start:u,end:p,name:o,index:n};return t("tr",{class:"part","data-active":!!r},t("td",null,t("code",null,o)),t("td",null,s(u)," → ",s(p)),t("td",null,t("button",{onClick:r?()=>{a({part:i,type:"reset"})}:()=>{a({part:i,type:"play"})}},r?"▢":"▷")),t("td",null,t("button",{onClick:()=>{a({part:i,type:"loop"})}},"↺")))},p=({src:o})=>{const c=e(null),[s,p]=n([]),[i,d]=n(1),h={part:null,action:null},[m,y]=r(((t,e)=>{switch(e.type){case"play":case"loop":return c.current.currentTime=e.part.start,c.current.play(),{part:e.part,action:e.type};case"reset":return c.current.pause(),h}}),h),b=e(),g=()=>{if(m.part&&c.current.currentTime>=m.part.end)switch(m.action){case"play":y({type:"reset"});break;case"loop":y({part:m.part,type:"loop"})}b.current=requestAnimationFrame(g)};a((()=>(b.current=requestAnimationFrame(g),()=>cancelAnimationFrame(b.current))),[m]),a((()=>{o&&fetch(o).then((t=>{t.blob().then((t=>{l.read(t,{onSuccess:t=>{p(t.tags.comment.text.split("\n"))},onError:t=>console.error(t)})}))}))}),[o]),a((()=>c.current.playbackRate=i),[i]);const v=t=>{d(parseFloat(t))};return t("div",{class:"track"},t("audio",{ref:c,src:o,controls:!0,controlsList:"nodownload",onpause:()=>y({type:"reset"})}),t("div",{class:"rate"},t("label",{for:"rate"},"Playback Rate"),t("input",{id:"rate",type:"number",value:parseFloat(i).toFixed(2),step:"0.05",min:"0.05",onChange:t=>v(t.target.value)}),t("button",{onClick:()=>v(.5)},"0.50"),t("button",{onClick:()=>v(.75)},"0.75"),t("button",{onClick:()=>v(1)},"1.00")),t("table",null,t("thead",null,t("tr",null,t("td",null,"Part"),t("td",null,"Time"),t("td",{style:{width:0}}),t("td",{style:{width:0}}))),t("tbody",null,s.map(((e,n)=>{var r;return t(u,{data:e,index:n,active:(null==(r=m.part)?void 0:r.index)===n,dispatch:y})})))))};o(t((()=>{const[e,r]=n(null);return t("div",null,t("h1",null,t("code",null,"tunetrainer")),t("input",{type:"file",id:"files",multiple:!0,onChange:t=>{const e=t.target.files[0],n=URL.createObjectURL(e);r(n)}}),e&&t(p,{src:e}))}),null),document.getElementById("app"));
